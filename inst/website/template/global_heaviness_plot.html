
<p>The heaviness categories are based on the following criterions:</p>
<ul>
<li>Red: adjusted heaviness on child packages larger than 30.</li>
<li>Orange: adjusted heaviness on child packages between 15 and 30.</li>
<li>grey: adjusted heaviness on child packages less than 15.</li>
</ul>

<div>
<input class="form-check-input" type="radio" name="plot-child-heaviness-radio" onchange="$('#plot-child-heaviness').show();$('#plot-child-adjusted-heaviness').hide();" checked>
  <label class="form-check-label" >
    Heaviness verse n_children
  </label>
<input class="form-check-input" type="radio" name="plot-child-heaviness-radio" onchange="$('#plot-child-heaviness').hide();$('#plot-child-adjusted-heaviness').show();">
  <label class="form-check-label">
    Adjusted heaviness verse n_children
  </label>
</div>
<div id="plot-child-heaviness">

<% tmp_file = paste0(fileext = ".png")

png(tmp_file, width = 1000*1.5, height = 500*1.5, res = 72*2)
heaviness = ifelse(df$adjusted_heaviness_on_children >= 30, "high", ifelse(df$adjusted_heaviness_on_children >= 15, "median", "low"))
repo = ifelse(grepl("bioconductor", df$repository), "Bioconductor", "CRAN")
df$repo = factor(repo, levels = c("CRAN", "Bioconductor"))
suppressWarnings({
	p = ggplot2::ggplot(df, ggplot2::aes(n_children, heaviness_on_children, color = heaviness, 
			label = ifelse(df$adjusted_heaviness_on_children >= 30, df$package, ""))) +
		ggplot2::geom_point() + 
		ggplot2::scale_color_manual(values = c("high" = "red", "median" = "orange", "low" = "grey")) +
		ggplot2::scale_x_continuous(trans='log10') +
		ggrepel::geom_text_repel(min.segment.length = 0, box.padding = 0.5, max.overlaps = Inf, show.legend = FALSE, size =3) +
		ggplot2::labs(x = "Number of child packages", y = "Heaviness") +
		ggplot2::ggtitle("Heaviness on child packages") +
		ggplot2::facet_wrap(ggplot2::vars(repo))
	ggplot2:::print.ggplot(p)
})
dev.off() %>

<%= img(tmp_file, style="height:500px")%>
<% file.remove(tmp_file) %>
</div>

<div id="plot-child-adjusted-heaviness" style="display:none;">

<% tmp_file = paste0(fileext = ".png")

png(tmp_file, width = 1000*1.5, height = 500*1.5, res = 72*2)
heaviness = ifelse(df$adjusted_heaviness_on_children >= 30, "high", ifelse(df$adjusted_heaviness_on_children >= 15, "median", "low"))
repo = ifelse(grepl("bioconductor", df$repository), "Bioconductor", "CRAN")
df$repo = factor(repo, levels = c("CRAN", "Bioconductor"))
suppressWarnings({
	p = ggplot2::ggplot(df, ggplot2::aes(n_children, adjusted_heaviness_on_children, color = heaviness, 
			label = ifelse(df$adjusted_heaviness_on_children >= 30, df$package, ""))) +
		ggplot2::geom_point() + 
		ggplot2::scale_color_manual(values = c("high" = "red", "median" = "orange", "low" = "grey")) +
		ggplot2::scale_x_continuous(trans='log10') +
		ggrepel::geom_text_repel(min.segment.length = 0, box.padding = 0.5, max.overlaps = Inf, show.legend = FALSE, size =3) +
		ggplot2::labs(x = "Number of child packages", y = "Adjusted heaviness") +
		ggplot2::ggtitle("Adjusted heaviness on child packages") +
		ggplot2::facet_wrap(ggplot2::vars(repo))
	ggplot2:::print.ggplot(p)
})
dev.off() %>

<%= img(tmp_file, style="height:500px")%>
<% file.remove(tmp_file) %>
</div>

<p>In the following plot, if a package has higher heaviness on downstream than on the child packages, it means it also affects more indirect downstream packages.</p>

<% tmp_file = paste0(fileext = ".png")

png(tmp_file, width = 1000*1.5, height = 500*1.5, res = 72*2)
heaviness = ifelse(df$adjusted_heaviness_on_downstream >= 30, "high", ifelse(df$adjusted_heaviness_on_downstream >= 15, "median", "low"))
repo = ifelse(grepl("bioconductor", df$repository), "Bioconductor", "CRAN")
df$repo = factor(repo, levels = c("CRAN", "Bioconductor"))
suppressWarnings({
	p = ggplot2::ggplot(df, ggplot2::aes(n_downstream, heaviness_on_downstream, color = heaviness, 
			label = ifelse(df$adjusted_heaviness_on_downstream >= 30, df$package, ""))) +
		ggplot2::geom_point() + 
		ggplot2::scale_color_manual(values = c("high" = "red", "median" = "orange", "low" = "grey")) +
		ggplot2::scale_x_continuous(trans='log10') +
		ggrepel::geom_text_repel(min.segment.length = 0, box.padding = 0.5, max.overlaps = Inf, show.legend = FALSE, size =3) +
		ggplot2::labs(x = "Number of downstream packages", y = "Heaviness") +
		ggplot2::ggtitle("Heaviness on downstream packages") +
		ggplot2::facet_wrap(ggplot2::vars(repo))
	ggplot2:::print.ggplot(p)
})
dev.off() %>

<%= img(tmp_file, style="height:500px")%>
<% file.remove(tmp_file) %>

